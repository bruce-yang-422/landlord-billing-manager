<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»è²»è¨ˆç®—å™¨ (æ­·å²ç´€éŒ„ç‰ˆ)</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }
        /* ä½ˆå±€èª¿æ•´ */
        .grid-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }
        .full-row {
            width: 100%;
            margin-bottom: 15px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.1);
        }
        /* æŒ‰éˆ•ç¾¤çµ„ */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: opacity 0.2s;
        }
        button:hover {
            opacity: 0.9;
        }
        .calculate-btn {
            background-color: #2ecc71;
            color: white;
            flex: 2;
        }
        .btn-export {
            background-color: #3498db;
            color: white;
            flex: 1;
        }
        .btn-import {
            background-color: #f39c12;
            color: white;
            flex: 1;
        }
        .btn-danger {
            background-color: #e74c3c;
            color: white;
            flex: 0.5;
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .report-area {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            min-height: 200px;
            font-size: 14px;
        }
        .copy-btn {
            background-color: #2196F3;
            color: white;
            padding: 8px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        .copy-btn:hover {
            background-color: #1976D2;
        }
        .usage-display {
            font-size: 18px;
            font-weight: bold;
            color: #2196F3;
            margin: 10px 0;
        }
        .total-display {
            font-size: 24px;
            font-weight: bold;
            color: #f44336;
            margin: 15px 0;
        }
        /* æ­·å²ç´€éŒ„è¡¨æ ¼ */
        .history-section {
            margin-top: 40px;
            border-top: 2px dashed #ddd;
            padding-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background-color: #f8f9fa;
            color: #666;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f1f1f1;
        }
        .delete-record {
            color: #e74c3c;
            cursor: pointer;
            font-weight: bold;
            border: none;
            background: none;
            padding: 5px;
            margin-right: 10px;
        }
        .view-record {
            color: #3498db;
            cursor: pointer;
            font-weight: bold;
            border: none;
            background: none;
            padding: 5px;
        }
        /* æª”æ¡ˆä¸Šå‚³éš±è— */
        #fileInput {
            display: none;
        }
        @media (max-width: 600px) {
            .grid-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .btn-group {
                flex-direction: column;
            }
            button {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš¡ é›»è²»è¨ˆç®—å™¨ <small style="font-size:0.5em; color:#888;">(æ­·å²ç´€éŒ„ç‰ˆ)</small></h1>
        
        <div class="grid-row">
            <div>
                <label for="billDate">ğŸ“… å¸³å–®æ—¥æœŸ</label>
                <input type="date" id="billDate" value="" placeholder="è«‹é¸æ“‡æ—¥æœŸ">
            </div>
            <div>
                <label for="pricePerUnit">ğŸ’° é›»è²»å–®åƒ¹ï¼ˆå…ƒ/åº¦ï¼‰</label>
                <input type="number" id="pricePerUnit" value="5.5" step="0.1" placeholder="è«‹è¼¸å…¥æ¯åº¦é›»è²»">
            </div>
        </div>
        
        <div class="grid-row">
            <div>
                <label for="lastReading">ğŸ”¢ ä¸ŠæœŸé›»éŒ¶è®€æ•¸</label>
                <input type="number" id="lastReading" value="8874" placeholder="è«‹è¼¸å…¥ä¸ŠæœŸè®€æ•¸">
            </div>
            <div>
                <label for="currentReading">ğŸ”¢ æœ¬æœŸé›»éŒ¶è®€æ•¸</label>
                <input type="number" id="currentReading" value="8988" placeholder="è«‹è¼¸å…¥æœ¬æœŸè®€æ•¸">
            </div>
        </div>
        
        <div class="grid-row">
            <div>
                <label for="rent">ğŸ  ç§Ÿé‡‘ï¼ˆå…ƒï¼‰</label>
                <input type="number" id="rent" value="7000" placeholder="è«‹è¼¸å…¥ç§Ÿé‡‘">
            </div>
            <div>
                <label for="gasFee">ğŸ”¥ ç“¦æ–¯è²»ï¼ˆå…ƒï¼‰</label>
                <input type="number" id="gasFee" value="0" placeholder="è«‹è¼¸å…¥ç“¦æ–¯è²»">
            </div>
        </div>
        
        <div class="full-row" style="background: #f9f9f9; padding: 15px; border-radius: 8px;">
            <label style="color:#2980b9;">ğŸ¦ æ”¶æ¬¾è³‡è¨Šï¼ˆè‡ªå‹•å¸¶å…¥ï¼‰</label>
            <div class="grid-row" style="margin-bottom: 0;">
                <input type="text" id="bankCode" placeholder="éŠ€è¡Œä»£ç¢¼" style="margin-bottom: 5px;">
                <input type="text" id="payeeName" placeholder="æˆ¶å" style="margin-bottom: 5px;">
            </div>
            <input type="text" id="accountNumber" placeholder="éŠ€è¡Œå¸³è™Ÿ">
        </div>
        
        <div class="btn-group">
            <button class="calculate-btn" onclick="calculateAndSave()">ğŸ’¾ è¨ˆç®—ä¸¦å­˜æª”</button>
            <button class="btn-export" onclick="exportData()">ğŸ“¤ å‚™ä»½è³‡æ–™ (JSON)</button>
            <button class="btn-import" onclick="document.getElementById('fileInput').click()">ğŸ“¥ åŒ¯å…¥è³‡æ–™</button>
            <input type="file" id="fileInput" accept=".json" onchange="importData(this)">
        </div>
        
        <div id="result" class="result" style="display: none;">
            <div class="usage-display">ç”¨é›»é‡ï¼š<span id="usage"></span> åº¦</div>
            <div>é›»è²»ï¼š$<span id="electricityFee"></span></div>
            <div>ç§Ÿé‡‘ï¼š$<span id="rentDisplay"></span></div>
            <div>ç“¦æ–¯è²»ï¼š$<span id="gasFeeDisplay"></span></div>
            <div class="total-display">æœ¬æœŸæ‡‰ä»˜ç¸½é‡‘é¡ï¼š$<span id="totalAmount"></span></div>
        </div>
        
        <div id="reportSection" style="display: none;">
            <h3>ğŸ“‹ LINE å ±è¡¨</h3>
            <div id="reportText" class="report-area"></div>
            <button class="copy-btn" onclick="copyReport()">ğŸ“‹ è¤‡è£½å ±è¡¨</button>
        </div>
        
        <div class="history-section">
            <h3>ğŸ“œ æ­·å²å¸³å–®ç´€éŒ„ 
                <button onclick="clearHistory()" style="float:right; font-size:12px; padding:5px 10px; background:#95a5a6; color:white; border:none; border-radius:4px; cursor:pointer;">æ¸…ç©ºç´€éŒ„</button>
            </h3>
            <div style="overflow-x: auto;">
                <table id="historyTable">
                    <thead>
                        <tr>
                            <th>æ—¥æœŸ</th>
                            <th>ç”¨é›»é‡</th>
                            <th>ç¸½é‡‘é¡</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="historyBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // è³‡æ–™åº«çµæ§‹ï¼š { settings: {}, records: [] }
        let appData = {
            settings: {
                pricePerUnit: 5.5,
                rent: 7000,
                bankCode: '',
                payeeName: '',
                accountNumber: ''
            },
            records: [] // å­˜æ”¾æ­·å²å¸³å–®
        };

        function calculateAndSave() {
            const lastReading = parseFloat(document.getElementById('lastReading').value) || 0;
            const currentReading = parseFloat(document.getElementById('currentReading').value) || 0;
            const pricePerUnit = parseFloat(document.getElementById('pricePerUnit').value) || 0;
            const rent = parseFloat(document.getElementById('rent').value) || 0;
            const gasFee = parseFloat(document.getElementById('gasFee').value) || 0;
            const billDate = document.getElementById('billDate').value;
            const payeeName = document.getElementById('payeeName').value;
            const bankCode = document.getElementById('bankCode').value;
            const accountNumber = document.getElementById('accountNumber').value;
            
            // é©—è­‰
            if (!billDate) {
                alert('è«‹é¸æ“‡å¸³å–®æ—¥æœŸï¼');
                return;
            }
            
            if (currentReading <= lastReading) {
                alert('æœ¬æœŸé›»éŒ¶è®€æ•¸å¿…é ˆå¤§æ–¼ä¸ŠæœŸè®€æ•¸ï¼');
                return;
            }
            
            const usage = currentReading - lastReading;
            const electricityFee = Math.round(usage * pricePerUnit);
            const totalAmount = electricityFee + rent + gasFee;
            
            // æ›´æ–°è¨­å®š (è¨˜æ†¶ä½¿ç”¨è€…çš„åå¥½)
            appData.settings = {
                pricePerUnit: pricePerUnit,
                rent: rent,
                bankCode: bankCode,
                payeeName: payeeName,
                accountNumber: accountNumber
            };
            
            // æ–°å¢ä¸€ç­†ç´€éŒ„
            const newRecord = {
                id: Date.now(), // å”¯ä¸€è­˜åˆ¥ç¢¼
                date: billDate,
                lastReading: lastReading,
                currentReading: currentReading,
                usage: usage,
                electricityFee: electricityFee,
                rent: rent,
                gasFee: gasFee,
                total: totalAmount,
                pricePerUnit: pricePerUnit
            };
            
            // æŠŠæ–°ç´€éŒ„åŠ åˆ°æœ€å‰é¢
            appData.records.unshift(newRecord);
            
            // å„²å­˜æ‰€æœ‰è¼¸å…¥å€¼åˆ° localStorageï¼ˆå³æ™‚è¨˜æ†¶ï¼‰
            saveAllInputs();
            
            // å„²å­˜æ­·å²è¨˜éŒ„åˆ° localStorage
            saveToLocalStorage();
            
            // æ›´æ–°ä»‹é¢
            renderHistory();
            generateReport(newRecord, appData.settings);
            
            alert('âœ… è¨ˆç®—å®Œæˆä¸¦å·²è‡ªå‹•å­˜æª”ï¼');
        }
        
        function generateReport(record, settings) {
            let dateStr;
            if (record.date) {
                const date = new Date(record.date);
                dateStr = date.getFullYear() + '/' + 
                         String(date.getMonth() + 1).padStart(2, '0') + '/' + 
                         String(date.getDate()).padStart(2, '0');
            } else {
                const now = new Date();
                dateStr = now.getFullYear() + '/' + 
                         String(now.getMonth() + 1).padStart(2, '0') + '/' + 
                         String(now.getDate()).padStart(2, '0');
            }
            
            const report = `ğŸ“… ${dateStr} æˆ¿ç§Ÿé›»è²»é€šçŸ¥
âš¡ é›»è²»è¨ˆç®—
${record.currentReading} (æœ¬æœŸ) - ${record.lastReading} (ä¸ŠæœŸ) 
= ${record.usage} åº¦
${record.usage} åº¦ Ã— ${record.pricePerUnit} = $${record.electricityFee}

ğŸ’° æ‡‰ç¹³é‡‘é¡
é›»è²»ï¼š$${record.electricityFee.toLocaleString()}
æˆ¿ç§Ÿï¼š$${record.rent.toLocaleString()}
ç“¦æ–¯ï¼š$${record.gasFee.toLocaleString()}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç¸½è¨ˆï¼š$${record.total.toLocaleString()}

ğŸ¦ åŒ¯æ¬¾è³‡è¨Š
(${settings.bankCode}) ${settings.accountNumber}
æˆ¶åï¼š${settings.payeeName}

è¨ˆç®—éç¨‹ï¼š
${record.currentReading} - ${record.lastReading} = ${record.usage} åº¦
${record.usage} Ã— ${record.pricePerUnit} = ${record.electricityFee}
${record.electricityFee} + ${record.rent} + ${record.gasFee} = ${record.total}`;
            
            document.getElementById('reportText').textContent = report;
            document.getElementById('reportSection').style.display = 'block';
        }
        
        // è‡ªå‹•å¡«å…¥ä¸ŠæœŸè®€æ•¸ (æ‰¾æœ€è¿‘çš„ä¸€ç­†ç´€éŒ„)
        function autoFillLastReading() {
            if (appData.records.length > 0) {
                // å–æœ€è¿‘ä¸€æ¬¡çš„ã€Œæœ¬æœŸã€ä½œç‚ºé€™æ¬¡çš„ã€Œä¸ŠæœŸã€
                document.getElementById('lastReading').value = appData.records[0].currentReading;
            }
        }
        
        // æ¸²æŸ“æ­·å²åˆ—è¡¨
        function renderHistory() {
            const tbody = document.getElementById('historyBody');
            tbody.innerHTML = '';
            
            if (appData.records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color:#999;">å°šç„¡æ­·å²ç´€éŒ„</td></tr>';
                return;
            }
            
            appData.records.forEach(record => {
                const tr = document.createElement('tr');
                const date = new Date(record.date);
                const dateStr = date.getFullYear() + '/' + 
                              String(date.getMonth() + 1).padStart(2, '0') + '/' + 
                              String(date.getDate()).padStart(2, '0');
                
                tr.innerHTML = `
                    <td>${dateStr}</td>
                    <td>${record.usage} åº¦</td>
                    <td style="color:#e74c3c; font-weight:bold;">$${record.total.toLocaleString()}</td>
                    <td>
                        <button class="delete-record" onclick="deleteRecord(${record.id})">åˆªé™¤</button>
                        <button class="view-record" onclick="loadRecord(${record.id})">æŸ¥çœ‹</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // åˆªé™¤å–®ç­†ç´€éŒ„
        function deleteRecord(id) {
            if(confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ')) {
                appData.records = appData.records.filter(r => r.id !== id);
                saveToLocalStorage();
                renderHistory();
            }
        }
        
        // æŸ¥çœ‹/è¼‰å…¥èˆŠç´€éŒ„åˆ°å ±è¡¨å€
        function loadRecord(id) {
            const record = appData.records.find(r => r.id === id);
            if(record) {
                generateReport(record, appData.settings);
                document.getElementById('reportSection').scrollIntoView({behavior: 'smooth'});
            }
        }
        
        // æ¸…ç©ºæ­·å²è¨˜éŒ„
        function clearHistory() {
            if(confirm('è­¦å‘Šï¼šé€™å°‡æ¸…ç©ºæ‰€æœ‰æ­·å²å¸³å–®ç´€éŒ„ï¼å»ºè­°å…ˆå‚™ä»½ JSONã€‚ç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ')) {
                appData.records = [];
                saveToLocalStorage();
                renderHistory();
            }
        }
        
        // --- è³‡æ–™å­˜å–æ ¸å¿ƒ ---
        function saveToLocalStorage() {
            try {
                localStorage.setItem('electricityCalculator_db', JSON.stringify(appData));
            } catch (e) {
                console.error('å„²å­˜å¤±æ•—:', e);
            }
        }
        
        function loadFromLocalStorage() {
            try {
                const json = localStorage.getItem('electricityCalculator_db');
                if (json) {
                    appData = JSON.parse(json);
                    
                    // é‚„åŸè¨­å®šå€¼åˆ° UI
                    if (appData.settings.pricePerUnit) {
                        document.getElementById('pricePerUnit').value = appData.settings.pricePerUnit;
                    }
                    if (appData.settings.rent) {
                        document.getElementById('rent').value = appData.settings.rent;
                    }
                    if (appData.settings.bankCode) {
                        document.getElementById('bankCode').value = appData.settings.bankCode;
                    }
                    if (appData.settings.payeeName) {
                        document.getElementById('payeeName').value = appData.settings.payeeName;
                    }
                    if (appData.settings.accountNumber) {
                        document.getElementById('accountNumber').value = appData.settings.accountNumber;
                    }
                    
                    renderHistory();
                }
            } catch (e) {
                console.error('è¼‰å…¥å¤±æ•—:', e);
            }
        }
        
        // åŒ¯å‡º JSON (å‚™ä»½)
        function exportData() {
            try {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(appData, null, 2));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                // ä½¿ç”¨å›ºå®šæª”åï¼Œæ¯æ¬¡åŒ¯å‡ºéƒ½æœƒè¦†è“‹åŒä¸€å€‹æª”æ¡ˆï¼Œé¿å…ç´¯ç©
                downloadAnchorNode.setAttribute("download", "billing-records-backup.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
                alert('âœ… è³‡æ–™å·²åŒ¯å‡ºï¼(æª”åï¼šbilling-records-backup.jsonï¼Œå·²è¦†è“‹èˆŠæª”æ¡ˆ)');
            } catch (e) {
                alert('âŒ åŒ¯å‡ºå¤±æ•—ï¼š' + e.message);
            }
        }
        
        // åŒ¯å…¥ JSON (é‚„åŸ)
        function importData(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    // ç°¡å–®æ ¼å¼æª¢æŸ¥
                    if (importedData.records && Array.isArray(importedData.records)) {
                        appData = importedData;
                        saveToLocalStorage();
                        loadFromLocalStorage(); // åˆ·æ–°ä»‹é¢
                        autoFillLastReading();
                        alert('âœ… è³‡æ–™åŒ¯å…¥æˆåŠŸï¼æ­·å²ç´€éŒ„å·²é‚„åŸã€‚');
                    } else {
                        alert('âŒ æª”æ¡ˆæ ¼å¼éŒ¯èª¤ï¼Œè«‹ç¢ºèªé€™æ˜¯æœ¬å·¥å…·åŒ¯å‡ºçš„ JSON æª”');
                    }
                } catch (error) {
                    alert('âŒ è®€å–å¤±æ•—ï¼š' + error);
                }
            };
            reader.readAsText(file);
            // æ¸…ç©º input è®“åŒå€‹æª”æ¡ˆå¯ä»¥å†æ¬¡è§¸ç™¼ change
            input.value = '';
        }
        
        function copyReport() {
            const reportText = document.getElementById('reportText').textContent;
            
            // ä½¿ç”¨ç¾ä»£çš„ Clipboard API
            if (navigator.clipboard) {
                navigator.clipboard.writeText(reportText).then(() => {
                    alert('âœ… å ±è¡¨å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼å¯ä»¥è²¼åˆ°LINEå›‰ï¼');
                }).catch(err => {
                    console.error('è¤‡è£½å¤±æ•—: ', err);
                    fallbackCopyTextToClipboard(reportText);
                });
            } else {
                fallbackCopyTextToClipboard(reportText);
            }
        }
        
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.top = "-999px";
            textArea.style.left = "-999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('âœ… å ±è¡¨å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼å¯ä»¥è²¼åˆ°LINEå›‰ï¼');
            } catch (err) {
                alert('âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–æ–‡å­—è¤‡è£½');
            }
            
            document.body.removeChild(textArea);
        }
        
        // å„²å­˜æ‰€æœ‰è¼¸å…¥å€¼åˆ° localStorage
        function saveAllInputs() {
            try {
                const inputs = {
                    lastReading: document.getElementById('lastReading').value,
                    currentReading: document.getElementById('currentReading').value,
                    pricePerUnit: document.getElementById('pricePerUnit').value,
                    rent: document.getElementById('rent').value,
                    gasFee: document.getElementById('gasFee').value,
                    billDate: document.getElementById('billDate').value,
                    payeeName: document.getElementById('payeeName').value,
                    bankCode: document.getElementById('bankCode').value,
                    accountNumber: document.getElementById('accountNumber').value
                };
                localStorage.setItem('electricityCalculator_inputs', JSON.stringify(inputs));
            } catch (e) {
                console.error('å„²å­˜å¤±æ•—:', e);
            }
        }
        
        // è¼‰å…¥æ‰€æœ‰è¼¸å…¥å€¼
        function loadAllInputs() {
            try {
                const saved = localStorage.getItem('electricityCalculator_inputs');
                if (saved) {
                    const inputs = JSON.parse(saved);
                    
                    if (inputs.lastReading) document.getElementById('lastReading').value = inputs.lastReading;
                    if (inputs.currentReading) document.getElementById('currentReading').value = inputs.currentReading;
                    if (inputs.pricePerUnit) document.getElementById('pricePerUnit').value = inputs.pricePerUnit;
                    if (inputs.rent) document.getElementById('rent').value = inputs.rent;
                    if (inputs.gasFee !== undefined) document.getElementById('gasFee').value = inputs.gasFee;
                    if (inputs.billDate) document.getElementById('billDate').value = inputs.billDate;
                    if (inputs.payeeName) document.getElementById('payeeName').value = inputs.payeeName;
                    if (inputs.bankCode) document.getElementById('bankCode').value = inputs.bankCode;
                    if (inputs.accountNumber) document.getElementById('accountNumber').value = inputs.accountNumber;
                }
            } catch (e) {
                console.error('è¼‰å…¥å¤±æ•—:', e);
            }
        }
        
        // ç‚ºæ‰€æœ‰è¼¸å…¥æ¬„ä½æ·»åŠ è‡ªå‹•å„²å­˜åŠŸèƒ½
        function setupAutoSave() {
            const inputIds = ['lastReading', 'currentReading', 'pricePerUnit', 'rent', 'gasFee', 'billDate', 'payeeName', 'bankCode', 'accountNumber'];
            
            inputIds.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', function() {
                        saveAllInputs();
                    });
                    input.addEventListener('change', function() {
                        saveAllInputs();
                    });
                }
            });
        }
        
        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.onload = function() {
            // è¨­å®šä»Šå¤©çš„æ—¥æœŸç‚ºé è¨­å€¼
            const today = new Date();
            const todayStr = today.getFullYear() + '-' + 
                           String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                           String(today.getDate()).padStart(2, '0');
            
            // å…ˆè¼‰å…¥æ­·å²è¨˜éŒ„è³‡æ–™åº«
            loadFromLocalStorage();
            
            // è¼‰å…¥å„²å­˜çš„è¼¸å…¥å€¼ï¼ˆå³æ™‚è¨˜æ†¶ï¼‰
            loadAllInputs();
            
            // å¦‚æœæ²’æœ‰å„²å­˜çš„æ—¥æœŸï¼Œè¨­å®šä»Šå¤©çš„æ—¥æœŸç‚ºé è¨­å€¼
            if (!document.getElementById('billDate').value) {
                document.getElementById('billDate').value = todayStr;
            }
            
            // æ ¹æ“šæ­·å²ç´€éŒ„è‡ªå‹•å¡«å…¥ã€Œä¸ŠæœŸè®€æ•¸ã€
            autoFillLastReading();
            
            // è¨­å®šè‡ªå‹•å„²å­˜åŠŸèƒ½
            setupAutoSave();
        };
        
        // æŒ‰Enteréµæ™‚è¨ˆç®—
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculateAndSave();
            }
        });
    </script>
</body>
</html>